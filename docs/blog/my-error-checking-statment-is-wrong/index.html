<!DOCTYPE html><html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta charset="utf-8" /><meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport" /><meta content="My error checking statment is wrong - Tommy Ku&#39;s Method Stub - Random thoughts, stories and tutorials of a web dev" name="title" /><meta content="Web developer Tommy Ku talks about his experience in work, learning and life." name="description" /><meta content="Tommy Ku" name="author" /><meta content="My error checking statment is wrong - Tommy Ku&#39;s Method Stub - Random thoughts, stories and tutorials of a web dev" property="og:title" /><meta content="article" property="og:type" /><title>My error checking statment is wrong - Tommy Ku&#39;s Method Stub</title><link href="/style/gutenberg.css" rel="stylesheet" /><link href="/style/tomorrow-night-eighties.css" rel="stylesheet" /><meta content="Nanoc 4.5.2" name="generator" /></head><body><header><h2><img class="author" src="/assets/images/author.jpg" />Tommy Ku's Method Stub</h2><p><i>Reading and thinking</i></p></header><nav><a href="/">Index</a><a href="https://hp.tommyku.com">About Me</a><a href="https://angel.co/tommyku">AngelList</a><a href="https://hk.linkedin.com/in/tommy-ku-65aba999">LinkedIn</a><a href="https://github.com/tommyku">GitHub</a></nav><main id="main"><section id="meta"><h1>My error checking statment is wrong</h1><i>Posted on 2014.07.23</i></section><section id="content">
<p>Spent an hour tracking down a bug in updating MySQL row, turned out it has nothing to do with my database library (yes looked into the Medoo library) but my error checking statement.</p>

<p>My code looks like this.</p>

<pre><code class="language-php">$row_affected = $database-&gt;update(//...bleh bleh bleh)
if ($row_affected != 1) {
  // http_internal_server_error
}
</code></pre>

<p>What it should look like.</p>

<pre><code class="language-php">$row_affected = $database-&gt;update(//...bleh bleh bleh)
if ($row_affected != 0 &amp;&amp; $row_affected != 1) {
  // http_internal_server_error
}
</code></pre>

<p>What is wrong with my error checking statement? MySQL is so clever that when an UPDATE is trying to update absolutely the same things to the columns, it will not write anything to the database. Then <code>$row_affected</code> will be zero and it throws an error.</p>

<blockquote>
  <p>If you set a column to the value it currently has, MySQL notices this and does not update it. 
Source: <a href="http://dev.mysql.com/doc/refman/5.1/en/update.html">MySQL :: MySQL 5.1 Reference Manual :: 13.2.10 UPDATE Syntax</a></p>
</blockquote>

<p>However, the best fix should be:</p>

<pre><code class="language-php">$row_affected = $database-&gt;update(//...bleh bleh bleh)
if ($database-&gt;error()[1] != 0) {
  // http_internal_server_error
}
</code></pre>

<p>This error checking statement detects errors in general, with error message available for programmer to debug. I would not have spent an hour fixing that if I had done this in the first time.</p>
</section></main><script src="/js/highlight.pack.js" type="text/javascript"></script><script>(function() {
  hljs.initHighlightingOnLoad();

}).call(this);
</script><div id="disqus_thread"></div><script>var disqus_config = function () {
  this.page.url = "https://blog.tommyku.com/blog/my-error-checking-statment-is-wrong/";
  this.page.identifier = "my-error-checking-statment-is-wrong";
};

(function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = '//methodstub.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();</script><noscript>Please enable JavaScript to view the <a ,="" href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-47055557-3', 'auto');
ga('send', 'pageview');</script></body></html>