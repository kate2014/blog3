<!DOCTYPE html><html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta charset="utf-8" /><meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport" /><meta content="Database config trick hosting Laravel on Openshift - Tommy Ku&#39;s Method Stub - Random thoughts, stories and tutorials of a web dev" name="title" /><meta content="Web developer Tommy Ku talks about his experience in work, learning and life." name="description" /><meta content="Tommy Ku" name="author" /><meta content="Database config trick hosting Laravel on Openshift - Tommy Ku&#39;s Method Stub - Random thoughts, stories and tutorials of a web dev" property="og:title" /><meta content="article" property="og:type" /><title>Database config trick hosting Laravel on Openshift - Tommy Ku&#39;s Method Stub</title><link href="/style/gutenberg.css" rel="stylesheet" /><link href="/style/tomorrow-night-eighties.css" rel="stylesheet" /><meta content="Nanoc 4.3.7" name="generator" /></head><body><header><h2><img class="author" src="/assets/images/author.jpg" />Tommy Ku's Method Stub</h2><p><i>Reading and thinking</i></p></header><nav><a href="/">Index</a><a href="https://hp.tommyku.com">About Me</a><a href="https://angel.co/tommyku">AngelList</a><a href="https://hk.linkedin.com/in/tommy-ku-65aba999">LinkedIn</a></nav><main id="main"><section id="meta"><h1>Database config trick hosting Laravel on Openshift</h1><i>Written on 2014.10.22</i></section><section id="content">
<p>Most of the case when I develop using Laravel, I would first host the app locally, then push the changes to Openshift when all tests are done. One thing that bugs me is every time I push I forgot to modify the database settings to Openshift’s database setting. The app crashes until I notice it and I ended up pushing an additional commit that does nothing but “fix db setting”.</p>

<p>So here are the fool-proof tricks that saved me from the pain of useless re-pushing.</p>

<h4 id="the-easy-way">The easy way</h4>

<p>Use .gitignore</p>

<p>When you push the app onto Openshift for the first time, push with Openshift’s database setting.</p>

<pre><code>app/config/database.php
</code></pre>

<pre><code class="language-php">/* the rest of the code */
'mysql' =&gt; array(
  'driver'    =&gt; 'mysql',
  'host'      =&gt; getenv('OPENSHIFT_MYSQL_DB_HOST'),
  'port'      =&gt; getenv('OPENSHIFT_MYSQL_DB_PORT'),
  'database'  =&gt; getenv('OPENSHIFT_APP_NAME'),
  'username'  =&gt; getenv('OPENSHIFT_MYSQL_DB_USERNAME'),
  'password'  =&gt; getenv('OPENSHIFT_MYSQL_DB_PASSWORD'),
  'charset'   =&gt; 'utf8',
  'collation' =&gt; 'utf8_unicode_ci',
  'prefix'    =&gt; '',
),
/* the rest of the code */
</code></pre>

<p>Then make yourself a .gitigore, or modify the existing one.</p>

<pre><code>.gitignore
</code></pre>

<pre><code class="language-bash">/bootstrap/compiled.php
/vendor
composer.phar
composer.lock
.env.*.php
.env.php
.DS_Store
Thumbs.db
/app/config/database.php
</code></pre>

<p>.gitignore guraranttes the enlisted files be ignored in git commit and git push, thus you can modify <code>database.php</code> to your local setting as much as you like. Next time you push, what stays on Openshift will be the <code>database.php</code> you originally pushed.</p>

<h4 id="another-way-for-your-interest">Another way for your interest</h4>

<p>In case your database setting cannot be separated from your code (uncommon, but possible), you can write down settings of both sides anyway. Openshift’s database settings are stored in environmental variable, which are not set in local environment. Since <a href="http://php.net/manual/en/function.getenv.php">getenv()</a> returns false when the requested variable does not exist, we can just fallback to local setting when the function returns false.</p>

<p>This is done using ternary if.</p>

<pre><code>app/config/database.php
</code></pre>

<pre><code class="language-php">/* the rest of the code */
'mysql' =&gt; array(
  'driver'    =&gt; 'mysql',
  'host'      =&gt; (getenv('OPENSHIFT_MYSQL_DB_HOST')) ? getenv('OPENSHIFT_MYSQL_DB_HOST') : 'LOCAL_MYSQL_HOST',
  'port'      =&gt; (getenv('OPENSHIFT_MYSQL_DB_PORT')) ? getenv('OPENSHIFT_MYSQL_DB_PORT') : LOCAL_MYSQL_PORT,
  'database'  =&gt; (getenv('OPENSHIFT_APP_NAME')) ? getenv('OPENSHIFT_APP_NAME') : 'LOCAL_MYSQL_DATABASE',
  'username'  =&gt; (getenv('OPENSHIFT_MYSQL_DB_USERNAME')) ? getenv('OPENSHIFT_MYSQL_DB_USERNAME') : 'LOCAL_MYSQL_USERNAME',
  'password'  =&gt; (getenv('OPENSHIFT_MYSQL_DB_PASSWORD')) ? getenv('OPENSHIFT_MYSQL_DB_PASSWORD') : 'LOCAL_MYSQL_PASSWORD',
  'charset'   =&gt; 'utf8',
  'collation' =&gt; 'utf8_unicode_ci',
  'prefix'    =&gt; '',
),
/* the rest of the code */
</code></pre>

<p>There may be some better solutions to this, drop some lines into the comment box if you do!</p>

</section></main><script src="/js/highlight.pack.js" type="text/javascript"></script><script>(function() {
  hljs.initHighlightingOnLoad();

}).call(this);
</script><div id="disqus_thread"></div><script>var disqus_config = function () {
  this.page.url = "https://blog.tommyku.com/blog/database-config-trick-hosting-laravel-on-openshift/";
  this.page.identifier = "database-config-trick-hosting-laravel-on-openshift";
};

(function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = '//methodstub.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();</script><noscript>Please enable JavaScript to view the <a ,="" href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-47055557-3', 'auto');
ga('send', 'pageview');</script></body></html>